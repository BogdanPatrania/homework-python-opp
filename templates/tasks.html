<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Background Tasks</title>
    <script>
        if (localStorage.getItem("darkMode") === "true") {
            document.documentElement.classList.add("dark-mode");
        }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2721/2721292.png" type="image/png">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #ff6f61, #ffb347);
            --card-bg: #ffffff;
            --text-color: #212529;
            --btn-color: #d63384;
            --bar-bg: #fff8f0;
        }
        html.dark-mode {
            --bg-gradient: linear-gradient(135deg, #141e30, #243b55);
            --card-bg: #1e1e1e;
            --text-color: #f8f9fa;
            --btn-color: #6f42c1;
            --bar-bg: #23272e;
        }
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: var(--bg-gradient);
            color: var(--text-color);
            transition: background 0.5s, color 0.5s;
        }
        .card {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: none;
            border-radius: 1rem;
        }
        .btn-primary {
            background-color: var(--btn-color);
            border-color: var(--btn-color);
        }
        .btn-primary:hover {
            opacity: 0.9;
        }
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .top-buttons .btn {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        border: 1px solid #e0e0e0;
        background-color: #f8f9fa;
        color: #212529;
        transition: background 0.2s, color 0.2s, border 0.2s;
        }
        .top-buttons .btn:hover, .top-buttons .btn:focus {
            background-color: #e9ecef;
            color: #d63384;
            border-color: #d63384;
        }
        html.dark-mode .top-buttons .btn {
            background-color: #23272e;
            color: #f8f9fa;
            border: 1px solid #444950;
        }
        html.dark-mode .top-buttons .btn:hover, html.dark-mode .top-buttons .btn:focus {
            background-color: #343a40;
            color: #6f42c1;
            border-color: #6f42c1;
        }
        .table-responsive {
            overflow-x: auto;
        }
        td, th { word-break: break-all; }
    </style>
    <script>
        function toggleDarkMode() {
            document.documentElement.classList.toggle("dark-mode");
            const isDark = document.documentElement.classList.contains("dark-mode");
            localStorage.setItem("darkMode", isDark ? "true" : "false");
        }
    </script>
</head>
<body>
    <!-- Top-right sticky button bar -->
    <div class="top-buttons d-flex flex-row gap-2 justify-content-end">
        <button class="btn btn-sm btn-light" onclick="toggleDarkMode()">Toggle Dark Mode</button>
        <a href="/" class="btn btn-sm btn-light">Back to Calculator</a>
        <a href="/history" class="btn btn-sm btn-light">View History</a>
    </div>
    <div class="container py-5 d-flex flex-column justify-content-center min-vh-100">
        <div class="mt-5 mb-4 px-3 text-center">
            <h2 class="fw-bold">Background Tasks</h2>
        </div>
        <div class="card p-3 fade-in">
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-sm align-middle mb-0">
                    <thead class="table-dark text-center">
                        <tr>
                            <th>Task ID</th>
                            <th>Operation</th>
                            <th>Input</th>
                            <th>Status</th>
                            <th>Result Summary</th>
                            <th>Link</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for task in tasks %}
                        <tr>
                            <td style="word-break: break-all;">{{ task.task_id }}</td>
                            <td>{{ task.operation }}</td>
                            <td>{{ task.input }}</td>
                            <td>{{ task.status }}</td>
                            <td>{{ task.result[:100] if task.result else "-" }}</td>
                            <td>
                                <a href="/status/{{ task.task_id }}" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>