<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Math Microservice</title>

    <!-- Prevent flicker: apply dark mode class before CSS loads -->
    <script>
        if (localStorage.getItem("darkMode") === "true") {
            document.documentElement.classList.add("dark-mode");
        }
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2721/2721292.png" type="image/png">

    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #ff6f61, #ffb347);
            --card-bg: #ffffff;
            --text-color: #212529;
            --btn-color: #d63384;
            --bar-bg: #fff8f0;
        }

        html.dark-mode {
            --bg-gradient: linear-gradient(135deg, #141e30, #243b55);
            --card-bg: #1e1e1e;
            --text-color: #f8f9fa;
            --btn-color: #6f42c1;
            --bar-bg: #23272e;
        }

        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background: var(--bg-gradient);
            color: var(--text-color);
            transition: background 0.5s, color 0.5s;
        }

        .card {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: none;
            border-radius: 1rem;
        }

        .form-label {
            font-weight: 600;
        }

        .btn-primary {
            background-color: var(--btn-color);
            border-color: var(--btn-color);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .toggle-switch {
            position: absolute;
            top: 20px;
            right: 30px;
        }

        .result-box {
            white-space: pre-wrap;
            word-break: break-all;
            max-width: 100%;
            overflow-x: auto;
            font-family: 'Inter', monospace;
            font-size: 1.1em;
            background: none;
            border: none;
            padding: 0;
        }

        .top-buttons .btn {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        border: 1px solid #e0e0e0;
        background-color: #f8f9fa;
        color: #212529;
        transition: background 0.2s, color 0.2s, border 0.2s;
        }
        .top-buttons .btn:hover, .top-buttons .btn:focus {
            background-color: #e9ecef;
            color: #d63384;
            border-color: #d63384;
        }
        html.dark-mode .top-buttons .btn {
            background-color: #23272e;
            color: #f8f9fa;
            border: 1px solid #444950;
        }
        html.dark-mode .top-buttons .btn:hover, html.dark-mode .top-buttons .btn:focus {
            background-color: #343a40;
            color: #6f42c1;
            border-color: #6f42c1;
        }
    </style>

    <script>
        function toggleValueB() {
            const op = document.getElementById("op_type").value;
            const bField = document.getElementById("b_field");
            if (op === "pow") {
                bField.style.display = "block";
            } else {
                bField.style.display = "none";
                document.getElementById("b").value = "";
            }
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle("dark-mode");
            const isDark = document.documentElement.classList.contains("dark-mode");
            localStorage.setItem("darkMode", isDark ? "true" : "false");
        }

        window.addEventListener("DOMContentLoaded", () => {
            if (localStorage.getItem("darkMode") === "true") {
                document.documentElement.classList.add("dark-mode");
            }

            document.getElementById("op_type").addEventListener("change", toggleValueB);
            toggleValueB();
        });
    </script>
</head>
<body>

<!-- Top-right sticky button bar -->
<div class="top-buttons d-flex flex-row gap-2 justify-content-end">
    <button class="btn btn-sm btn-light" onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <a href="/history" class="btn btn-sm btn-light">View History</a>
    <a href="/tasks" class="btn btn-sm btn-light">View Tasks</a>
</div>

<div class="container py-5 d-flex flex-column justify-content-center min-vh-100">
    <div class="mt-5 mb-4 px-3 text-center">
        <h1 class="fw-bold">Math Microservice</h1>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <form method="post" class="card p-4 shadow-lg d-flex flex-column gap-3">
                <div>
                    <label for="op_type" class="form-label">Choose operation</label>
                    <select class="form-select" name="op_type" id="op_type" required>
                        <option value="pow" {% if op_type == "pow" %}selected{% endif %}>Power (a ^ b)</option>
                        <option value="fibonacci" {% if op_type == "fibonacci" %}selected{% endif %}>Fibonacci (n)</option>
                        <option value="factorial" {% if op_type == "factorial" %}selected{% endif %}>Factorial (n!)</option>
                    </select>
                </div>

                <div>
                    <label for="a" class="form-label">Value A</label>
                    <input type="number" class="form-control" name="a" id="a" required placeholder="Enter base or n">
                </div>

                <div id="b_field">
                    <label for="b" class="form-label">Value B (only for Power)</label>
                    <input type="number" class="form-control" name="b" id="b" placeholder="Enter exponent">
                </div>

                <button type="submit" class="btn btn-primary w-100 w-md-auto">Compute</button>
            </form>

            {% if result is defined %}
            <div class="alert alert-light mt-4 text-center shadow-sm fade-in" role="alert" style="overflow-x:auto;">
                <h4 class="mb-0 text-dark">Result:</h4>
                <pre class="result-box" ...>{{ result | safe }}</pre>
            </div>
            {% endif %}
        </div>
    </div>
</div>

</body>
</html>
